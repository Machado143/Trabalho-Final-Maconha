{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Pai do Verde{% endblock %}</title>

    <!-- Fontes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;500;600;700&family=Caveat:wght@700&display=swap" rel="stylesheet">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="{% static 'css/global.css' %}">
</head>
<body>

<header class="site-header">
    <div class="header-inner">

        <!-- Logo -->
        <div class="site-branding">
            <a class="navbar-brand fw-bold d-flex align-items-center" href="{% url 'index' %}">
                ğŸŒ¿ Pai do Verde
            </a>
        </div>

        <!-- NavegaÃ§Ã£o Desktop -->
        <nav class="site-navigation d-none d-lg-flex">
            <ul>
                <li><a href="{% url 'listar_plantas' %}">CatÃ¡logo</a></li>
                <li><a href="{% url 'ranking' %}">Ranking</a></li>
                <li><a href="{% url 'feed' %}">Feed</a></li>
                <li><a href="{% url 'colecoes' %}">ColeÃ§Ãµes</a></li>
            </ul>
        </nav>

        <!-- Busca -->
        <form method="get" action="{% url 'buscar' %}" class="d-flex mx-auto my-2 my-lg-0" style="width: 30%; max-width: 300px;">
            <input type="text" name="q" class="form-control form-control-osm rounded-pill"
                   placeholder="Buscar plantas..." value="{{ request.GET.q|default:'' }}">
            <button type="submit" class="btn btn-sm btn-osm ms-2">ğŸ”</button>
        </form>

        <!-- UsuÃ¡rio -->
        <div class="d-flex align-items-center gap-2">

            {% if user.is_authenticated %}
                <!-- NotificaÃ§Ãµes -->
                <a href="{% url 'listar_notificacoes' %}" class="btn btn-header rounded-circle position-relative" style="width: 40px; height: 40px;">
                    ğŸ””
                    {% if notificacoes_nao_lidas|default:0 > 0 %}
                        <span class="position-absolute top-0 start-100 translate-middle badge bg-danger rounded-pill" style="font-size: .6rem;">
                            {{ notificacoes_nao_lidas }}
                        </span>
                    {% endif %}
                </a>

                <!-- Avatar -->
                <div class="dropdown">
                    <a href="#" class="nav-link dropdown-toggle d-flex align-items-center gap-2"
                       data-bs-toggle="dropdown" aria-expanded="false">

                        {% if user.profile.avatar %}
                            <img src="{{ user.profile.avatar.url }}" alt="Avatar" class="avatar-osm">
                        {% else %}
                            <span style="font-size: 1.3rem;">ğŸ‘¤</span>
                        {% endif %}

                        <span class="d-none d-lg-inline text-white fw-semibold">
                            {{ user.username }}
                        </span>
                    </a>

                    <ul class="dropdown-menu dropdown-menu-end shadow-sm">
                        <li><a class="dropdown-item" href="{% url 'ver_perfil' user.username %}">Meu Perfil</a></li>
                        <li><a class="dropdown-item" href="{% url 'editar_perfil' %}">Editar Perfil</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <form method="post" action="{% url 'logout' %}">
                                {% csrf_token %}
                                <button class="dropdown-item text-danger" type="submit">Sair</button>
                            </form>
                        </li>
                    </ul>
                </div>

            {% else %}
                <a href="{% url 'login' %}" class="btn btn-header-outline btn-sm">Entrar</a>
                <a href="{% url 'signup' %}" class="btn btn-header btn-sm">Cadastrar</a>
            {% endif %}
        </div>

        <!-- Mobile Toggle -->
        <button class="site-navigation-toggle d-lg-none"
                data-bs-toggle="collapse"
                data-bs-target="#navbarMobile">
            â˜°
        </button>
    </div>
</header>

<!-- Menu Mobile -->
<div class="collapse d-lg-none" id="navbarMobile">
    <div class="site-navigation">
        <ul>
            <li><a href="{% url 'listar_plantas' %}">CatÃ¡logo</a></li>
            <li><a href="{% url 'ranking' %}">Ranking</a></li>
            <li><a href="{% url 'feed' %}">Feed</a></li>
            <li><a href="{% url 'colecoes' %}">ColeÃ§Ãµes</a></li>

            {% if user.is_authenticated %}
                <li><a href="{% url 'ver_perfil' user.username %}">Meu Perfil</a></li>
                <li>
                    <form method="post" action="{% url 'logout' %}">
                        {% csrf_token %}
                        <button type="submit" class="btn text-danger w-100 text-start">Sair</button>
                    </form>
                </li>
            {% else %}
                <li><a href="{% url 'login' %}">Entrar</a></li>
                <li><a href="{% url 'signup' %}">Cadastrar</a></li>
            {% endif %}
        </ul>
    </div>
</div>

<main class="container" style="margin-top: 120px;">
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endfor %}
    {% endif %}
    {% block content %}{% endblock %}
</main>

<footer class="site-footer">
    <div class="footer-inner">
        <a href="{% url 'index' %}" class="navbar-brand">ğŸŒ¿ Pai do Verde</a>
        <span class="text-white">&copy; 2025 Pai do Verde</span>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
